function googleError(){alert("cannot load Google Map")}function loadMarkers(){var e=new google.maps.LatLngBounds;markers().forEach(function(n){n.setMap(map),e.extend(n.position)}),map.fitBounds(e)}function getAllMarkers(e){for(var n=0;n<e.length;n++){var t=e[n].location,o=e[n].title,a=e[n].genre,i=e[n].ajaxContent=ko.observable("pending search..."),r=new google.maps.Marker({position:t,title:o,genre:a,ajaxContent:i,animation:google.maps.Animation.DROP,id:n});infowindow=new google.maps.InfoWindow,markers.push(r),r.addListener("click",function(){var e=this;populateInfoWindow(e,infowindow),toggleBounce(e)})}}function populateInfoWindow(e,n){if("pending search..."===e.ajaxContent()){n.setContent(e.ajaxContent()),n.open(map,e);var t="https://api.foursquare.com/v2/venues/explore",o="CAD3EEXMNHQFJ4HD215D4EA0KB10WHQGXSRQCV2LFOGFSFCF",a="WN4UXNSSMR25SNOMT5VCEBWVVONFQ4HUBGQZZ3DLDI1T5O5F";$.ajax({url:t,dataType:"json",data:"limit=1&ll="+e.position.lat()+","+e.position.lng()+"&query="+e.title+"&client_id="+o+"&client_secret="+a+"&v=20161106&m=foursquare",method:"GET",async:!0}).done(function(t){e.rating=t.response.groups[0].items[0].venue.rating,e.rating||(e.rating="No rating in foursquare");var o='<br><div class="labels"><div class="title">'+e.title+'</div><div class="rating">Foursquare rating: '+e.rating+"</div></div>";e.ajaxContent(o),n.setContent(e.ajaxContent())}).fail(function(e){alert("Could not load data from foursquare!")})}else n.setContent(e.ajaxContent()),n.open(map,e)}function toggleBounce(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},700))}function ViewModel(){var e=this;e.list=ko.observableArray(dataArray),e.currentFilter=ko.observable(),e.filters=ko.observableArray(["filter 0","filter 1"]),e.filter=ko.observable(""),e.locationSelect=function(e){google.maps.event.trigger(e,"click")},e.filteredItems=ko.computed(function(){var n=e.filter();return n&&"filter 0"!==n?ko.utils.arrayFilter(markers(),function(e){var t=e.genre==n;return e.setVisible(t),infowindow&&infowindow.close(),t}):(markers().forEach(function(e){e.setVisible(!0)}),markers())})}var dataArray=[{title:"Park Ave Penthouse",location:{lat:40.7713024,lng:-73.9632393},genre:"filter 1"},{title:"Chelsea Loft",location:{lat:40.7444883,lng:-73.9949465},genre:"filter 0"},{title:"Union Square Open Floor Plan",location:{lat:40.7347062,lng:-73.9895759},genre:"filter 1"},{title:"East Village Hip Studio",location:{lat:40.7281777,lng:-73.984377},genre:"filter 0"},{title:"TriBeCa Artsy Bachelor Pad",location:{lat:40.7195264,lng:-74.0089934},genre:"filter 1"},{title:"Chinatown Homey Space",location:{lat:40.7180628,lng:-73.9961237},genre:"filter 0"}],map,markers=ko.observableArray(),infowindow;initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13});new google.maps.LatLngBounds;getAllMarkers(dataArray),loadMarkers()},ko.applyBindings(new ViewModel);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsInZpZXdtb2RlbC5qcyIsImRhdGFBcnJheS5qcyJdLCJuYW1lcyI6WyJnb29nbGVFcnJvciIsImFsZXJ0IiwibG9hZE1hcmtlcnMiLCJib3VuZHMiLCJnb29nbGUiLCJtYXBzIiwiTGF0TG5nQm91bmRzIiwibWFya2VycyIsImZvckVhY2giLCJtYXJrZXIiLCJzZXRNYXAiLCJtYXAiLCJleHRlbmQiLCJwb3NpdGlvbiIsImZpdEJvdW5kcyIsImdldEFsbE1hcmtlcnMiLCJsb2NhdGlvbnMiLCJpIiwibGVuZ3RoIiwibG9jYXRpb24iLCJ0aXRsZSIsImdlbnJlIiwiY29udGVudCIsImFqYXhDb250ZW50Iiwia28iLCJvYnNlcnZhYmxlIiwiTWFya2VyIiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsImlkIiwiaW5mb3dpbmRvdyIsIkluZm9XaW5kb3ciLCJwdXNoIiwiYWRkTGlzdGVuZXIiLCJ0aGlzIiwicG9wdWxhdGVJbmZvV2luZG93IiwidG9nZ2xlQm91bmNlIiwic2V0Q29udGVudCIsIm9wZW4iLCJ1cmwiLCJpZEZTcSIsInNlY3JldEZzcSIsIiQiLCJhamF4IiwiZGF0YVR5cGUiLCJkYXRhIiwibGF0IiwibG5nIiwibWV0aG9kIiwiYXN5bmMiLCJkb25lIiwicmVzdWx0IiwicmF0aW5nIiwicmVzcG9uc2UiLCJncm91cHMiLCJpdGVtcyIsInZlbnVlIiwiZmFpbCIsImVyciIsImdldEFuaW1hdGlvbiIsInNldEFuaW1hdGlvbiIsIkJPVU5DRSIsInNldFRpbWVvdXQiLCJWaWV3TW9kZWwiLCJzZWxmIiwibGlzdCIsIm9ic2VydmFibGVBcnJheSIsImRhdGFBcnJheSIsImN1cnJlbnRGaWx0ZXIiLCJmaWx0ZXJzIiwiZmlsdGVyIiwibG9jYXRpb25TZWxlY3QiLCJsb2MiLCJldmVudCIsInRyaWdnZXIiLCJmaWx0ZXJlZEl0ZW1zIiwiY29tcHV0ZWQiLCJ1dGlscyIsImFycmF5RmlsdGVyIiwibWF0Y2giLCJzZXRWaXNpYmxlIiwiY2xvc2UiLCJpbml0TWFwIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNlbnRlciIsInpvb20iLCJhcHBseUJpbmRpbmdzIl0sIm1hcHBpbmdzIjoiQUFBQSxRQUFBQSxlQUNBQyxNQUFBLDBCQTRCQSxRQUFBQyxlQUNBLEdBQUFDLEdBQUEsR0FBQUMsUUFBQUMsS0FBQUMsWUFFQUMsV0FBQUMsUUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxPQUFBQyxLQUNBUixFQUFBUyxPQUFBSCxFQUFBSSxZQUVBRixJQUFBRyxVQUFBWCxHQUlBLFFBQUFZLGVBQUFDLEdBQ0EsSUFBQSxHQUFBQyxHQUFBLEVBQUFBLEVBQUFELEVBQUFFLE9BQUFELElBQUEsQ0FFQSxHQUFBSixHQUFBRyxFQUFBQyxHQUFBRSxTQUNBQyxFQUFBSixFQUFBQyxHQUFBRyxNQUNBQyxFQUFBTCxFQUFBQyxHQUFBSSxNQUNBQyxFQUFBTixFQUFBQyxHQUFBTSxZQUFBQyxHQUFBQyxXQUFBLHFCQUVBaEIsRUFBQSxHQUFBTCxRQUFBQyxLQUFBcUIsUUFDQWIsU0FBQUEsRUFDQU8sTUFBQUEsRUFDQUMsTUFBQUEsRUFDQUUsWUFBQUQsRUFDQUssVUFBQXZCLE9BQUFDLEtBQUF1QixVQUFBQyxLQUNBQyxHQUFBYixHQUdBYyxZQUFBLEdBQUEzQixRQUFBQyxLQUFBMkIsV0FHQXpCLFFBQUEwQixLQUFBeEIsR0FFQUEsRUFBQXlCLFlBQUEsUUFBQSxXQUNBLEdBQUF6QixHQUFBMEIsSUFDQUMsb0JBQUEzQixFQUFBc0IsWUFDQU0sYUFBQTVCLE1BUUEsUUFBQTJCLG9CQUFBM0IsRUFBQXNCLEdBR0EsR0FBQSxzQkFBQXRCLEVBQUFjLGNBQUEsQ0FDQVEsRUFBQU8sV0FBQTdCLEVBQUFjLGVBQ0FRLEVBQUFRLEtBQUE1QixJQUFBRixFQUVBLElBQUErQixHQUFBLCtDQUVBQyxFQUFBLG1EQUVBQyxFQUFBLGtEQUdBQyxHQUFBQyxNQUNBSixJQUFBQSxFQUNBSyxTQUFBLE9BQ0FDLEtBQUEsY0FBQXJDLEVBQUFJLFNBQUFrQyxNQUFBLElBQUF0QyxFQUFBSSxTQUFBbUMsTUFBQSxVQUFBdkMsRUFBQVcsTUFBQSxjQUFBcUIsRUFDQSxrQkFBQUMsRUFBQSwyQkFDQU8sT0FBQSxNQUNBQyxPQUFBLElBQ0FDLEtBQUEsU0FBQUMsR0FHQTNDLEVBQUE0QyxPQUFBRCxFQUFBRSxTQUFBQyxPQUFBLEdBQUFDLE1BQUEsR0FBQUMsTUFBQUosT0FFQTVDLEVBQUE0QyxTQUNBNUMsRUFBQTRDLE9BQUEsMEJBR0EsSUFBQS9CLEdBQUEsOENBQUFiLEVBQUFXLE1BQ0EsZ0RBQUFYLEVBQUE0QyxPQUFBLGNBQ0E1QyxHQUFBYyxZQUFBRCxHQUNBUyxFQUFBTyxXQUFBN0IsRUFBQWMsaUJBRUFtQyxLQUFBLFNBQUFDLEdBR0ExRCxNQUFBLDhDQU1BOEIsR0FBQU8sV0FBQTdCLEVBQUFjLGVBQ0FRLEVBQUFRLEtBQUE1QixJQUFBRixHQU9BLFFBQUE0QixjQUFBNUIsR0FDQSxPQUFBQSxFQUFBbUQsZUFDQW5ELEVBQUFvRCxhQUFBLE9BRUFwRCxFQUFBb0QsYUFBQXpELE9BQUFDLEtBQUF1QixVQUFBa0MsUUFDQUMsV0FBQSxXQUNBdEQsRUFBQW9ELGFBQUEsT0FDQSxNQ2xJQSxRQUFBRyxhQUNBLEdBQUFDLEdBQUE5QixJQUVBOEIsR0FBQUMsS0FBQTFDLEdBQUEyQyxnQkFBQUMsV0FDQUgsRUFBQUksY0FBQTdDLEdBQUFDLGFBQ0F3QyxFQUFBSyxRQUFBOUMsR0FBQTJDLGlCQUFBLFdBQUEsYUFDQUYsRUFBQU0sT0FBQS9DLEdBQUFDLFdBQUEsSUFFQXdDLEVBQUFPLGVBQUEsU0FBQUMsR0FDQXJFLE9BQUFDLEtBQUFxRSxNQUFBQyxRQUFBRixFQUFBLFVBSUFSLEVBQUFXLGNBQUFwRCxHQUFBcUQsU0FBQSxXQUNBLEdBQUFOLEdBQUFOLEVBQUFNLFFBQ0EsT0FBQUEsSUFBQSxhQUFBQSxFQVNBL0MsR0FBQXNELE1BQUFDLFlBQUF4RSxVQUFBLFNBQUFVLEdBRUEsR0FBQStELEdBQUEvRCxFQUFBSSxPQUFBa0QsQ0FNQSxPQUxBdEQsR0FBQWdFLFdBQUFELEdBRUFqRCxZQUNBQSxXQUFBbUQsUUFFQUYsS0FkQXpFLFVBQUFDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQXdFLFlBQUEsS0FFQTFFLGFDdkJBLEdBQUE2RCxhQUNBaEQsTUFBQSxxQkFDQUQsVUFDQTRCLElBQUEsV0FDQUMsS0FBQSxZQUVBM0IsTUFBQSxhQUVBRCxNQUFBLGVBQ0FELFVBQ0E0QixJQUFBLFdBQ0FDLEtBQUEsWUFFQTNCLE1BQUEsYUFFQUQsTUFBQSwrQkFDQUQsVUFDQTRCLElBQUEsV0FDQUMsS0FBQSxZQUVBM0IsTUFBQSxhQUVBRCxNQUFBLDBCQUNBRCxVQUNBNEIsSUFBQSxXQUNBQyxLQUFBLFdBRUEzQixNQUFBLGFBRUFELE1BQUEsNkJBQ0FELFVBQ0E0QixJQUFBLFdBQ0FDLEtBQUEsWUFFQTNCLE1BQUEsYUFFQUQsTUFBQSx3QkFDQUQsVUFDQTRCLElBQUEsV0FDQUMsS0FBQSxZQUVBM0IsTUFBQSxhRnJDQVYsSUFFQUosUUFBQWlCLEdBQUEyQyxrQkFFQXBDLFVBRUFvRCxTQUFBLFdBR0F4RSxJQUFBLEdBQUFQLFFBQUFDLEtBQUErRSxJQUFBQyxTQUFBQyxlQUFBLFFBQ0FDLFFBQ0F4QyxJQUFBLFdBQ0FDLEtBQUEsWUFFQXdDLEtBQUEsSUFNQSxJQUFBcEYsUUFBQUMsS0FBQUMsWUFDQVMsZUFBQXFELFdBQ0FsRSxlQ2tCQXNCLEdBQUFpRSxjQUFBLEdBQUF6QiIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGdvb2dsZUVycm9yKCkge1xuICAgIGFsZXJ0KCdjYW5ub3QgbG9hZCBHb29nbGUgTWFwJyk7XG59XG4vLyBDcmVhdGUgYSBtYXAgdmFyaWFibGVcbnZhciBtYXA7XG4vLyBDcmVhdGUgYSBuZXcgYmxhbmsgYXJyYXkgZm9yIGFsbCB0aGUgbGlzdGluZyBtYXJrZXJzLlxudmFyIG1hcmtlcnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbi8vIENyZWF0ZSBnbG9iYWwgdmFyIGZvciBpbmZvd2luZG93XG52YXIgaW5mb3dpbmRvdztcblxuaW5pdE1hcCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgLy8gQ29uc3RydWN0b3IgY3JlYXRlcyBhIG5ldyBtYXAgLSBvbmx5IGNlbnRlciBhbmQgem9vbSBhcmUgcmVxdWlyZWQuXG4gICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgY2VudGVyOiB7XG4gICAgICAgICAgICBsYXQ6IDQwLjc0MTM1NDksXG4gICAgICAgICAgICBsbmc6IC03My45OTgwMjQ0XG4gICAgICAgIH0sXG4gICAgICAgIHpvb206IDEzXG4gICAgfSk7XG4gICAgLy8gVGhlc2UgYXJlIHRoZSByZWFsIGVzdGF0ZSBsaXN0aW5ncyB0aGF0IHdpbGwgYmUgc2hvd24gdG8gdGhlIHVzZXIuXG4gICAgLy8gTm9ybWFsbHkgd2UnZCBoYXZlIHRoZXNlIGluIGEgZGF0YWJhc2UgaW5zdGVhZC5cbiAgICAvL3ZhciBsYXJnZUluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xuXG4gICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICBnZXRBbGxNYXJrZXJzKGRhdGFBcnJheSk7XG4gICAgbG9hZE1hcmtlcnMoKTtcbn07XG4vLyBUaGlzIGZ1bmN0aW9uIHdpbGwgbG9vcCB0aHJvdWdoIHRoZSBtYXJrZXJzIGFycmF5IGFuZCBkaXNwbGF5IHRoZW0gYWxsLlxuZnVuY3Rpb24gbG9hZE1hcmtlcnMoKSB7XG4gICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAvLyBFeHRlbmQgdGhlIGJvdW5kYXJpZXMgb2YgdGhlIG1hcCBmb3IgZWFjaCBtYXJrZXIgYW5kIGRpc3BsYXkgdGhlIG1hcmtlclxuICAgIG1hcmtlcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKG1hcmtlcikge1xuICAgICAgICBtYXJrZXIuc2V0TWFwKG1hcCk7XG4gICAgICAgIGJvdW5kcy5leHRlbmQobWFya2VyLnBvc2l0aW9uKTtcbiAgICB9KTtcbiAgICBtYXAuZml0Qm91bmRzKGJvdW5kcyk7XG59XG5cbi8vIFRoZSBmb2xsb3dpbmcgZ3JvdXAgdXNlcyB0aGUgbG9jYXRpb24gYXJyYXkgdG8gY3JlYXRlIGFuIGFycmF5IG9mIG1hcmtlcnMgb24gaW5pdGlhbGl6ZS5cbmZ1bmN0aW9uIGdldEFsbE1hcmtlcnMobG9jYXRpb25zKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2NhdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gR2V0IHRoZSBwb3NpdGlvbiBmcm9tIHRoZSBsb2NhdGlvbiBhcnJheS5cbiAgICAgICAgdmFyIHBvc2l0aW9uID0gbG9jYXRpb25zW2ldLmxvY2F0aW9uO1xuICAgICAgICB2YXIgdGl0bGUgPSBsb2NhdGlvbnNbaV0udGl0bGU7XG4gICAgICAgIHZhciBnZW5yZSA9IGxvY2F0aW9uc1tpXS5nZW5yZTtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBsb2NhdGlvbnNbaV0uYWpheENvbnRlbnQgPSBrby5vYnNlcnZhYmxlKCdwZW5kaW5nIHNlYXJjaC4uLicpO1xuICAgICAgICAvLyBDcmVhdGUgYSBtYXJrZXIgcGVyIGxvY2F0aW9uLCBhbmQgcHV0IGludG8gbWFya2VycyBhcnJheS5cbiAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgZ2VucmU6IGdlbnJlLFxuICAgICAgICAgICAgYWpheENvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxuICAgICAgICAgICAgaWQ6IGlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG5cbiAgICAgICAgLy8gUHVzaCB0aGUgbWFya2VyIHRvIG91ciBhcnJheSBvZiBtYXJrZXJzLlxuICAgICAgICBtYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgLy8gQ3JlYXRlIGFuIG9uY2xpY2sgZXZlbnQgdG8gb3BlbiBhbiBpbmZvd2luZG93IGF0IGVhY2ggbWFya2VyLlxuICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gdGhpcztcbiAgICAgICAgICAgIHBvcHVsYXRlSW5mb1dpbmRvdyhtYXJrZXIsIGluZm93aW5kb3cpO1xuICAgICAgICAgICAgdG9nZ2xlQm91bmNlKG1hcmtlcik7XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG59XG4vLyBjb25zb2xlLmxvZyhtYXJrZXJzKCkpO1xuXG5mdW5jdGlvbiBwb3B1bGF0ZUluZm9XaW5kb3cobWFya2VyLCBpbmZvd2luZG93KSB7XG4gICAgLy9pZiBtYXJrZXIuYWpheENvbnRlbnQgaXMgc2V0IHRvIHRoZSBzdGFuZGFyZCB2YWx1ZSwgaW5pdCB0aGUgYWpheCBjYWxsIHRvIGdvIGFuZCB1cGRhdGUgdGhlIGluZm93aW5kb3cgY29udGVudFxuICAgIC8vb25jZSBhamF4LmNvbnRlbnQgaXMgc2V0LCBqdXN0IHNob3cgdGhlIGFscmVhZHkgZXhpc3RpbmcgY29udGVudCwgbm8gbmVlZCB0byBnbyBhbmQgZ2V0IGFqYXggY29udGVudCBhZ2FpblxuICAgIGlmIChtYXJrZXIuYWpheENvbnRlbnQoKSA9PT0gXCJwZW5kaW5nIHNlYXJjaC4uLlwiKSB7XG4gICAgICAgIGluZm93aW5kb3cuc2V0Q29udGVudChtYXJrZXIuYWpheENvbnRlbnQoKSk7XG4gICAgICAgIGluZm93aW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgIC8vIEJFR0lOIEZPVVJTUVVBUkUgQUpBWCBJTklUXG4gICAgICAgIHZhciB1cmwgPSBcImh0dHBzOi8vYXBpLmZvdXJzcXVhcmUuY29tL3YyL3ZlbnVlcy9leHBsb3JlXCI7XG4gICAgICAgIC8vZm91cnNxdWFyZSBjbGllbnQgSURcbiAgICAgICAgdmFyIGlkRlNxID0gJ0NBRDNFRVhNTkhRRko0SEQyMTVENEVBMEtCMTBXSFFHWFNSUUNWMkxGT0dGU0ZDRic7XG4gICAgICAgIC8vZm91cnNxdWFyZSBjbGllbnQgU2VjcmV0XG4gICAgICAgIHZhciBzZWNyZXRGc3EgPSAnV040VVhOU1NNUjI1U05PTVQ1VkNFQldWVk9ORlE0SFVCR1FaWjNETERJMVQ1TzVGJztcbiAgICAgICAgLy9jb25zb2xlLmxvZyhtYXJrZXIucG9zaXRpb24pO1xuICAgICAgICAvL2lmIHN0YXRlbWVudCAgLSBpZiBpbmZvciBoYXMgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCwgZG8gYWpheCBjYWxsLCBvdGhlcndpc2Ugb3BlbiB0aGUgYWxyZWFkeSBleGlzdGluZyBpbmZvd2luZG93LlxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgZGF0YTogXCJsaW1pdD0xJmxsPVwiICsgbWFya2VyLnBvc2l0aW9uLmxhdCgpICsgXCIsXCIgKyBtYXJrZXIucG9zaXRpb24ubG5nKCkgKyBcIiZxdWVyeT1cIiArIG1hcmtlci50aXRsZSArIFwiJlwiICsgXCJjbGllbnRfaWQ9XCIgKyBpZEZTcSArXG4gICAgICAgICAgICAgICAgXCImY2xpZW50X3NlY3JldD1cIiArIHNlY3JldEZzcSArIFwiJnY9MjAxNjExMDYmbT1mb3Vyc3F1YXJlXCIsXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgYXN5bmM6IHRydWUsXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzdWx0KSB7XG5cbiAgICAgICAgICAgIC8vIFRPRE86IGNhbGxiYWNrIGZ1bmN0aW9uIGlmIHN1Y2NlcyAtIFdpbGwgYWRkIHRoZSByYXRpbmcgcmVjZWl2ZWQgZnJvbSBmb3Vyc3F1YXJlIHRvIHRoZSBjb250ZW50IG9mIHRoZSBpbmZvIHdpbmRvd1xuICAgICAgICAgICAgbWFya2VyLnJhdGluZyA9IHJlc3VsdC5yZXNwb25zZS5ncm91cHNbMF0uaXRlbXNbMF0udmVudWUucmF0aW5nO1xuXG4gICAgICAgICAgICBpZiAoIW1hcmtlci5yYXRpbmcpIHtcbiAgICAgICAgICAgICAgICBtYXJrZXIucmF0aW5nID0gJ05vIHJhdGluZyBpbiBmb3Vyc3F1YXJlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnPGJyPjxkaXYgY2xhc3M9XCJsYWJlbHNcIj4nICsgJzxkaXYgY2xhc3M9XCJ0aXRsZVwiPicgKyBtYXJrZXIudGl0bGUgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj48ZGl2IGNsYXNzPVwicmF0aW5nXCI+Rm91cnNxdWFyZSByYXRpbmc6ICcgKyBtYXJrZXIucmF0aW5nICsgJzwvZGl2PicgKyAnPC9kaXY+JztcbiAgICAgICAgICAgIG1hcmtlci5hamF4Q29udGVudChjb250ZW50KTtcbiAgICAgICAgICAgIGluZm93aW5kb3cuc2V0Q29udGVudChtYXJrZXIuYWpheENvbnRlbnQoKSk7XG5cbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcblxuICAgICAgICAgICAgLy9pbmZvd2luZG93LnNldENvbnRlbnQobWFya2VyLmFqYXhDb250ZW50KFwiQ291bGQgbm90IGxvYWQgZGF0YSBmcm9tIGZvdXJzcXVhcmUhXCIpKTtcbiAgICAgICAgICAgIGFsZXJ0KFwiQ291bGQgbm90IGxvYWQgZGF0YSBmcm9tIGZvdXJzcXVhcmUhXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBFTkQgRk9VUlNRVUFSRSBBSkFYXG5cbiAgICB9IGVsc2Uge1xuICAgICAgICBpbmZvd2luZG93LnNldENvbnRlbnQobWFya2VyLmFqYXhDb250ZW50KCkpO1xuICAgICAgICBpbmZvd2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xuICAgIH1cblxufVxuXG5cbi8vIFNldCBhbmltYXRpb24gXG5mdW5jdGlvbiB0b2dnbGVCb3VuY2UobWFya2VyKSB7XG4gICAgaWYgKG1hcmtlci5nZXRBbmltYXRpb24oKSAhPT0gbnVsbCkge1xuICAgICAgICBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xuICAgICAgICB9LCA3MDApO1xuICAgIH1cbn0iLCIvL1ZpZXdNb2RlbFxuXG5mdW5jdGlvbiBWaWV3TW9kZWwoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5saXN0ID0ga28ub2JzZXJ2YWJsZUFycmF5KGRhdGFBcnJheSk7XG4gICAgc2VsZi5jdXJyZW50RmlsdGVyID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHNlbGYuZmlsdGVycyA9IGtvLm9ic2VydmFibGVBcnJheShbJ2ZpbHRlciAwJywgJ2ZpbHRlciAxJ10pO1xuICAgIHNlbGYuZmlsdGVyID0ga28ub2JzZXJ2YWJsZSgnJyk7XG5cbiAgICBzZWxmLmxvY2F0aW9uU2VsZWN0ID0gZnVuY3Rpb24obG9jKSB7XG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIobG9jLCAnY2xpY2snKTtcbiAgICB9O1xuXG5cbiAgICBzZWxmLmZpbHRlcmVkSXRlbXMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGZpbHRlciA9IHNlbGYuZmlsdGVyKCk7XG4gICAgICAgIGlmICghZmlsdGVyIHx8IGZpbHRlciA9PT0gJ2ZpbHRlciAwJykge1xuXG4gICAgICAgICAgICAvLyBTSE9XIEFMTCBNQVJLRVJTIFdIRU4gRklMVEVSIFJFU0VUU1xuICAgICAgICAgICAgbWFya2VycygpLmZvckVhY2goZnVuY3Rpb24obWFya2VyKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXJzKCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBrby51dGlscy5hcnJheUZpbHRlcihtYXJrZXJzKCksIGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAvLyBDUkVBVEUgTUFUQ0ggVkFSSUFCTEUgVE8gVVNFIFRPIFNFVCBNQVJLRVIgVklTSUJJTElUWVxuICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IGkuZ2VucmUgPT0gZmlsdGVyO1xuICAgICAgICAgICAgICAgIGkuc2V0VmlzaWJsZShtYXRjaCk7XG4gICAgICAgICAgICAgICAgLy9jbG9zZSBhbnkgb3BlbiBpbmZvd2luZG93c1xuICAgICAgICAgICAgICAgIGlmIChpbmZvd2luZG93KSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm93aW5kb3cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbn1cblxuLy8gQWN0aXZhdGVzIGtub2Nrb3V0LmpzXG5rby5hcHBseUJpbmRpbmdzKG5ldyBWaWV3TW9kZWwoKSk7IiwidmFyIGRhdGFBcnJheSA9IFt7XG4gICAgdGl0bGU6ICdQYXJrIEF2ZSBQZW50aG91c2UnLFxuICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIGxhdDogNDAuNzcxMzAyNCxcbiAgICAgICAgbG5nOiAtNzMuOTYzMjM5M1xuICAgIH0sXG4gICAgZ2VucmU6ICdmaWx0ZXIgMSdcbn0sIHtcbiAgICB0aXRsZTogJ0NoZWxzZWEgTG9mdCcsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43NDQ0ODgzLFxuICAgICAgICBsbmc6IC03My45OTQ5NDY1XG4gICAgfSxcbiAgICBnZW5yZTogJ2ZpbHRlciAwJ1xufSwge1xuICAgIHRpdGxlOiAnVW5pb24gU3F1YXJlIE9wZW4gRmxvb3IgUGxhbicsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43MzQ3MDYyLFxuICAgICAgICBsbmc6IC03My45ODk1NzU5XG4gICAgfSxcbiAgICBnZW5yZTogJ2ZpbHRlciAxJ1xufSwge1xuICAgIHRpdGxlOiAnRWFzdCBWaWxsYWdlIEhpcCBTdHVkaW8nLFxuICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIGxhdDogNDAuNzI4MTc3NyxcbiAgICAgICAgbG5nOiAtNzMuOTg0Mzc3XG4gICAgfSxcbiAgICBnZW5yZTogJ2ZpbHRlciAwJ1xufSwge1xuICAgIHRpdGxlOiAnVHJpQmVDYSBBcnRzeSBCYWNoZWxvciBQYWQnLFxuICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIGxhdDogNDAuNzE5NTI2NCxcbiAgICAgICAgbG5nOiAtNzQuMDA4OTkzNFxuICAgIH0sXG4gICAgZ2VucmU6ICdmaWx0ZXIgMSdcbn0sIHtcbiAgICB0aXRsZTogJ0NoaW5hdG93biBIb21leSBTcGFjZScsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43MTgwNjI4LFxuICAgICAgICBsbmc6IC03My45OTYxMjM3XG4gICAgfSxcbiAgICBnZW5yZTogJ2ZpbHRlciAwJ1xufV07Il19
