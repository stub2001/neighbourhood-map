function loadMarkers(){for(var e=new google.maps.LatLngBounds,n=0;n<markers().length;n++)markers()[n].setMap(map),e.extend(markers()[n].position);map.fitBounds(e)}function getAllMarkers(e){for(var n=0;n<e.length;n++){var t=e[n].location,o=e[n].title,a=e[n].genre,i=new google.maps.Marker({position:t,title:o,genre:a,animation:google.maps.Animation.DROP,id:n});infowindow=new google.maps.InfoWindow,getFS(i),markers.push(i),i.addListener("click",function(){populateInfoWindow(this,infowindow),toggleBounce(this)})}}function getFS(e){var n="https://api.foursquare.com/v2/venues/explore",t="CAD3EEXMNHQFJ4HD215D4EA0KB10WHQGXSRQCV2LFOGFSFCF",o="WN4UXNSSMR25SNOMT5VCEBWVVONFQ4HUBGQZZ3DLDI1T5O5F";$.ajax({url:n,dataType:"json",data:"limit=1&ll="+e.position.lat()+","+e.position.lng()+"&query="+e.title+"&client_id="+t+"&client_secret="+o+"&v=20161106&m=foursquare",method:"GET",async:!0}).done(function(n){e.rating=n.response.groups[0].items[0].venue.rating,e.rating||(e.rating="No rating in foursquare"),e.content='<br><div class="labels"><div class="title">'+e.title+'</div><div class="rating">Foursquare rating: '+e.rating+"</div></div>"}).fail(function(e){alert("Could not load data from foursquare!")})}function toggleBounce(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},750))}function populateInfoWindow(e,n){n.marker!=e&&(n.marker=e,n.setContent("<div>"+e.content+"</div>"),n.open(map,e),n.addListener("closeclick",function(){n.marker=null}))}function ViewModel(){var e=this;e.list=ko.observableArray(dataArray),e.currentFilter=ko.observable(),e.filters=ko.observableArray([0,1]),e.filter=ko.observable(""),e.locationSelect=function(e){google.maps.event.trigger(e,"click")},e.filteredItems=ko.computed(function(){var n=e.filter();return n&&0!=n?ko.utils.arrayFilter(markers(),function(e){var t=e.genre==n;return e.setVisible(t),infowindow&&infowindow.close(),t}):(markers().forEach(function(e){e.setVisible(!0)}),markers())})}var dataArray=[{title:"Park Ave Penthouse",location:{lat:40.7713024,lng:-73.9632393},genre:"1"},{title:"Chelsea Loft",location:{lat:40.7444883,lng:-73.9949465},genre:"0"},{title:"Union Square Open Floor Plan",location:{lat:40.7347062,lng:-73.9895759},genre:"1"},{title:"East Village Hip Studio",location:{lat:40.7281777,lng:-73.984377},genre:"0"},{title:"TriBeCa Artsy Bachelor Pad",location:{lat:40.7195264,lng:-74.0089934},genre:"1"},{title:"Chinatown Homey Space",location:{lat:40.7180628,lng:-73.9961237},genre:"0"}],map,markers=ko.observableArray(),infowindow;initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13});new google.maps.LatLngBounds;getAllMarkers(dataArray),loadMarkers()},ko.applyBindings(new ViewModel);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsInZpZXdtb2RlbC5qcyIsImRhdGFBcnJheS5qcyJdLCJuYW1lcyI6WyJsb2FkTWFya2VycyIsImJvdW5kcyIsImdvb2dsZSIsIm1hcHMiLCJMYXRMbmdCb3VuZHMiLCJpIiwibWFya2VycyIsImxlbmd0aCIsInNldE1hcCIsIm1hcCIsImV4dGVuZCIsInBvc2l0aW9uIiwiZml0Qm91bmRzIiwiZ2V0QWxsTWFya2VycyIsImxvY2F0aW9ucyIsImxvY2F0aW9uIiwidGl0bGUiLCJnZW5yZSIsIm1hcmtlciIsIk1hcmtlciIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJpZCIsImluZm93aW5kb3ciLCJJbmZvV2luZG93IiwiZ2V0RlMiLCJwdXNoIiwiYWRkTGlzdGVuZXIiLCJwb3B1bGF0ZUluZm9XaW5kb3ciLCJ0aGlzIiwidG9nZ2xlQm91bmNlIiwidXJsIiwiaWRGU3EiLCJzZWNyZXRGc3EiLCIkIiwiYWpheCIsImRhdGFUeXBlIiwiZGF0YSIsImxhdCIsImxuZyIsIm1ldGhvZCIsImFzeW5jIiwiZG9uZSIsInJlc3VsdCIsInJhdGluZyIsInJlc3BvbnNlIiwiZ3JvdXBzIiwiaXRlbXMiLCJ2ZW51ZSIsImNvbnRlbnQiLCJmYWlsIiwiZXJyIiwiYWxlcnQiLCJnZXRBbmltYXRpb24iLCJzZXRBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0Iiwic2V0Q29udGVudCIsIm9wZW4iLCJWaWV3TW9kZWwiLCJzZWxmIiwibGlzdCIsImtvIiwib2JzZXJ2YWJsZUFycmF5IiwiZGF0YUFycmF5IiwiY3VycmVudEZpbHRlciIsIm9ic2VydmFibGUiLCJmaWx0ZXJzIiwiZmlsdGVyIiwibG9jYXRpb25TZWxlY3QiLCJsb2MiLCJldmVudCIsInRyaWdnZXIiLCJmaWx0ZXJlZEl0ZW1zIiwiY29tcHV0ZWQiLCJ1dGlscyIsImFycmF5RmlsdGVyIiwibWF0Y2giLCJzZXRWaXNpYmxlIiwiY2xvc2UiLCJmb3JFYWNoIiwiaW5pdE1hcCIsIk1hcCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjZW50ZXIiLCJ6b29tIiwiYXBwbHlCaW5kaW5ncyJdLCJtYXBwaW5ncyI6IkFBMEJBLFFBQUFBLGVBR0EsSUFBQSxHQUZBQyxHQUFBLEdBQUFDLFFBQUFDLEtBQUFDLGFBRUFDLEVBQUEsRUFBQUEsRUFBQUMsVUFBQUMsT0FBQUYsSUFDQUMsVUFBQUQsR0FBQUcsT0FBQUMsS0FDQVIsRUFBQVMsT0FBQUosVUFBQUQsR0FBQU0sU0FFQUYsS0FBQUcsVUFBQVgsR0FJQSxRQUFBWSxlQUFBQyxHQUNBLElBQUEsR0FBQVQsR0FBQSxFQUFBQSxFQUFBUyxFQUFBUCxPQUFBRixJQUFBLENBRUEsR0FBQU0sR0FBQUcsRUFBQVQsR0FBQVUsU0FDQUMsRUFBQUYsRUFBQVQsR0FBQVcsTUFDQUMsRUFBQUgsRUFBQVQsR0FBQVksTUFFQUMsRUFBQSxHQUFBaEIsUUFBQUMsS0FBQWdCLFFBQ0FSLFNBQUFBLEVBQ0FLLE1BQUFBLEVBQ0FDLE1BQUFBLEVBQ0FHLFVBQUFsQixPQUFBQyxLQUFBa0IsVUFBQUMsS0FDQUMsR0FBQWxCLEdBR0FtQixZQUFBLEdBQUF0QixRQUFBQyxLQUFBc0IsV0FDQUMsTUFBQVIsR0FFQVosUUFBQXFCLEtBQUFULEdBRUFBLEVBQUFVLFlBQUEsUUFBQSxXQUNBQyxtQkFBQUMsS0FBQU4sWUFDQU8sYUFBQUQsU0FPQSxRQUFBSixPQUFBUixHQUVBLEdBQUFjLEdBQUEsK0NBRUFDLEVBQUEsbURBRUFDLEVBQUEsa0RBRUFDLEdBQUFDLE1BQ0FKLElBQUFBLEVBQ0FLLFNBQUEsT0FDQUMsS0FBQSxjQUFBcEIsRUFBQVAsU0FBQTRCLE1BQUEsSUFBQXJCLEVBQUFQLFNBQUE2QixNQUFBLFVBQUF0QixFQUFBRixNQUFBLGNBQUFpQixFQUNBLGtCQUFBQyxFQUFBLDJCQUNBTyxPQUFBLE1BQ0FDLE9BQUEsSUFDQUMsS0FBQSxTQUFBQyxHQUdBMUIsRUFBQTJCLE9BQUFELEVBQUFFLFNBQUFDLE9BQUEsR0FBQUMsTUFBQSxHQUFBQyxNQUFBSixPQUVBM0IsRUFBQTJCLFNBQ0EzQixFQUFBMkIsT0FBQSwyQkFHQTNCLEVBQUFnQyxRQUFBLDhDQUFBaEMsRUFBQUYsTUFDQSxnREFBQUUsRUFBQTJCLE9BQUEsaUJBRUFNLEtBQUEsU0FBQUMsR0FFQUMsTUFBQSwwQ0FRQSxRQUFBdEIsY0FBQWIsR0FDQSxPQUFBQSxFQUFBb0MsZUFDQXBDLEVBQUFxQyxhQUFBLE9BRUFyQyxFQUFBcUMsYUFBQXJELE9BQUFDLEtBQUFrQixVQUFBbUMsUUFDQUMsV0FBQSxXQUNBdkMsRUFBQXFDLGFBQUEsT0FDQSxNQU1BLFFBQUExQixvQkFBQVgsRUFBQU0sR0FFQUEsRUFBQU4sUUFBQUEsSUFDQU0sRUFBQU4sT0FBQUEsRUFDQU0sRUFBQWtDLFdBQUEsUUFBQXhDLEVBQUFnQyxRQUFBLFVBQ0ExQixFQUFBbUMsS0FBQWxELElBQUFTLEdBRUFNLEVBQUFJLFlBQUEsYUFBQSxXQUNBSixFQUFBTixPQUFBLFFDMUhBLFFBQUEwQyxhQUNBLEdBQUFDLEdBQUEvQixJQUVBK0IsR0FBQUMsS0FBQUMsR0FBQUMsZ0JBQUFDLFdBQ0FKLEVBQUFLLGNBQUFILEdBQUFJLGFBQ0FOLEVBQUFPLFFBQUFMLEdBQUFDLGlCQUFBLEVBQUEsSUFDQUgsRUFBQVEsT0FBQU4sR0FBQUksV0FBQSxJQUVBTixFQUFBUyxlQUFBLFNBQUFDLEdBQ0FyRSxPQUFBQyxLQUFBcUUsTUFBQUMsUUFBQUYsRUFBQSxVQUdBVixFQUFBYSxjQUFBWCxHQUFBWSxTQUFBLFdBQ0EsR0FBQU4sR0FBQVIsRUFBQVEsUUFDQSxPQUFBQSxJQUFBLEdBQUFBLEVBU0FOLEdBQUFhLE1BQUFDLFlBQUF2RSxVQUFBLFNBQUFELEdBRUEsR0FBQXlFLEdBQUF6RSxFQUFBWSxPQUFBb0QsQ0FNQSxPQUxBaEUsR0FBQTBFLFdBQUFELEdBRUF0RCxZQUNBQSxXQUFBd0QsUUFFQUYsS0FkQXhFLFVBQUEyRSxRQUFBLFNBQUEvRCxHQUNBQSxFQUFBNkQsWUFBQSxLQUVBekUsYUN0QkEsR0FBQTJELGFBQ0FqRCxNQUFBLHFCQUNBRCxVQUNBd0IsSUFBQSxXQUNBQyxLQUFBLFlBRUF2QixNQUFBLE1BRUFELE1BQUEsZUFDQUQsVUFDQXdCLElBQUEsV0FDQUMsS0FBQSxZQUVBdkIsTUFBQSxNQUVBRCxNQUFBLCtCQUNBRCxVQUNBd0IsSUFBQSxXQUNBQyxLQUFBLFlBRUF2QixNQUFBLE1BRUFELE1BQUEsMEJBQ0FELFVBQ0F3QixJQUFBLFdBQ0FDLEtBQUEsV0FFQXZCLE1BQUEsTUFFQUQsTUFBQSw2QkFDQUQsVUFDQXdCLElBQUEsV0FDQUMsS0FBQSxZQUVBdkIsTUFBQSxNQUVBRCxNQUFBLHdCQUNBRCxVQUNBd0IsSUFBQSxXQUNBQyxLQUFBLFlBRUF2QixNQUFBLE1GeENBUixJQUVBSCxRQUFBeUQsR0FBQUMsa0JBRUF4QyxVQUVBMEQsU0FBQSxXQUdBekUsSUFBQSxHQUFBUCxRQUFBQyxLQUFBZ0YsSUFBQUMsU0FBQUMsZUFBQSxRQUNBQyxRQUNBL0MsSUFBQSxXQUNBQyxLQUFBLFlBRUErQyxLQUFBLElBTUEsSUFBQXJGLFFBQUFDLEtBQUFDLFlBQ0FTLGVBQUFvRCxXQUNBakUsZUNvQkErRCxHQUFBeUIsY0FBQSxHQUFBNUIiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDcmVhdGUgYSBtYXAgdmFyaWFibGVcbnZhciBtYXA7XG4vLyBDcmVhdGUgYSBuZXcgYmxhbmsgYXJyYXkgZm9yIGFsbCB0aGUgbGlzdGluZyBtYXJrZXJzLlxudmFyIG1hcmtlcnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbi8vIENyZWF0ZSBnbG9iYWwgdmFyIGZvciBpbmZvd2luZG93XG52YXIgaW5mb3dpbmRvdztcblxuaW5pdE1hcCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vIENvbnN0cnVjdG9yIGNyZWF0ZXMgYSBuZXcgbWFwIC0gb25seSBjZW50ZXIgYW5kIHpvb20gYXJlIHJlcXVpcmVkLlxuICAgICAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICAgICAgY2VudGVyOiB7XG4gICAgICAgICAgICAgICAgbGF0OiA0MC43NDEzNTQ5LFxuICAgICAgICAgICAgICAgIGxuZzogLTczLjk5ODAyNDRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB6b29tOiAxM1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlc2UgYXJlIHRoZSByZWFsIGVzdGF0ZSBsaXN0aW5ncyB0aGF0IHdpbGwgYmUgc2hvd24gdG8gdGhlIHVzZXIuXG4gICAgICAgIC8vIE5vcm1hbGx5IHdlJ2QgaGF2ZSB0aGVzZSBpbiBhIGRhdGFiYXNlIGluc3RlYWQuXG4gICAgICAgIC8vdmFyIGxhcmdlSW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG5cbiAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAgICAgZ2V0QWxsTWFya2VycyhkYXRhQXJyYXkpO1xuICAgICAgICBsb2FkTWFya2VycygpO1xuICAgIH1cbiAgICAvLyBUaGlzIGZ1bmN0aW9uIHdpbGwgbG9vcCB0aHJvdWdoIHRoZSBtYXJrZXJzIGFycmF5IGFuZCBkaXNwbGF5IHRoZW0gYWxsLlxuZnVuY3Rpb24gbG9hZE1hcmtlcnMoKSB7XG4gICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAvLyBFeHRlbmQgdGhlIGJvdW5kYXJpZXMgb2YgdGhlIG1hcCBmb3IgZWFjaCBtYXJrZXIgYW5kIGRpc3BsYXkgdGhlIG1hcmtlclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2VycygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG1hcmtlcnMoKVtpXS5zZXRNYXAobWFwKTtcbiAgICAgICAgYm91bmRzLmV4dGVuZChtYXJrZXJzKClbaV0ucG9zaXRpb24pO1xuICAgIH1cbiAgICBtYXAuZml0Qm91bmRzKGJvdW5kcyk7XG59XG5cbi8vIFRoZSBmb2xsb3dpbmcgZ3JvdXAgdXNlcyB0aGUgbG9jYXRpb24gYXJyYXkgdG8gY3JlYXRlIGFuIGFycmF5IG9mIG1hcmtlcnMgb24gaW5pdGlhbGl6ZS5cbmZ1bmN0aW9uIGdldEFsbE1hcmtlcnMobG9jYXRpb25zKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2NhdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gR2V0IHRoZSBwb3NpdGlvbiBmcm9tIHRoZSBsb2NhdGlvbiBhcnJheS5cbiAgICAgICAgdmFyIHBvc2l0aW9uID0gbG9jYXRpb25zW2ldLmxvY2F0aW9uO1xuICAgICAgICB2YXIgdGl0bGUgPSBsb2NhdGlvbnNbaV0udGl0bGU7XG4gICAgICAgIHZhciBnZW5yZSA9IGxvY2F0aW9uc1tpXS5nZW5yZTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgbWFya2VyIHBlciBsb2NhdGlvbiwgYW5kIHB1dCBpbnRvIG1hcmtlcnMgYXJyYXkuXG4gICAgICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIGdlbnJlOiBnZW5yZSxcbiAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1AsXG4gICAgICAgICAgICBpZDogaVxuICAgICAgICB9KTtcblxuICAgICAgICBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcbiAgICAgICAgZ2V0RlMobWFya2VyKTtcbiAgICAgICAgLy8gUHVzaCB0aGUgbWFya2VyIHRvIG91ciBhcnJheSBvZiBtYXJrZXJzLlxuICAgICAgICBtYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgLy8gQ3JlYXRlIGFuIG9uY2xpY2sgZXZlbnQgdG8gb3BlbiBhbiBpbmZvd2luZG93IGF0IGVhY2ggbWFya2VyLlxuICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwb3B1bGF0ZUluZm9XaW5kb3codGhpcywgaW5mb3dpbmRvdyk7XG4gICAgICAgICAgICB0b2dnbGVCb3VuY2UodGhpcyk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxufVxuLy8gY29uc29sZS5sb2cobWFya2VycygpKTtcblxuZnVuY3Rpb24gZ2V0RlMobWFya2VyKSB7XG4gICAgLy8gQkVHSU4gRk9VUlNRVUFSRSBBSkFYIElOSVRcbiAgICB2YXIgdXJsID0gXCJodHRwczovL2FwaS5mb3Vyc3F1YXJlLmNvbS92Mi92ZW51ZXMvZXhwbG9yZVwiO1xuICAgIC8vZm91cnNxdWFyZSBjbGllbnQgSURcbiAgICB2YXIgaWRGU3EgPSAnQ0FEM0VFWE1OSFFGSjRIRDIxNUQ0RUEwS0IxMFdIUUdYU1JRQ1YyTEZPR0ZTRkNGJztcbiAgICAvL2ZvdXJzcXVhcmUgY2xpZW50IFNlY3JldFxuICAgIHZhciBzZWNyZXRGc3EgPSAnV040VVhOU1NNUjI1U05PTVQ1VkNFQldWVk9ORlE0SFVCR1FaWjNETERJMVQ1TzVGJztcbiAgICAvL2NvbnNvbGUubG9nKG1hcmtlci5wb3NpdGlvbik7XG4gICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGRhdGE6IFwibGltaXQ9MSZsbD1cIiArIG1hcmtlci5wb3NpdGlvbi5sYXQoKSArIFwiLFwiICsgbWFya2VyLnBvc2l0aW9uLmxuZygpICsgXCImcXVlcnk9XCIgKyBtYXJrZXIudGl0bGUgKyBcIiZcIiArIFwiY2xpZW50X2lkPVwiICsgaWRGU3EgK1xuICAgICAgICAgICAgXCImY2xpZW50X3NlY3JldD1cIiArIHNlY3JldEZzcSArIFwiJnY9MjAxNjExMDYmbT1mb3Vyc3F1YXJlXCIsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGFzeW5jOiB0cnVlLFxuICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzdWx0KSB7XG5cbiAgICAgICAgLy9jYWxsYmFjayBmdW5jdGlvbiBpZiBzdWNjZXMgLSBXaWxsIGFkZCB0aGUgcmF0aW5nIHJlY2VpdmVkIGZyb20gZm91cnNxdWFyZSB0byB0aGUgY29udGVudCBvZiB0aGUgaW5mbyB3aW5kb3dcbiAgICAgICAgbWFya2VyLnJhdGluZyA9IHJlc3VsdC5yZXNwb25zZS5ncm91cHNbMF0uaXRlbXNbMF0udmVudWUucmF0aW5nO1xuXG4gICAgICAgIGlmICghbWFya2VyLnJhdGluZykge1xuICAgICAgICAgICAgbWFya2VyLnJhdGluZyA9ICdObyByYXRpbmcgaW4gZm91cnNxdWFyZSc7XG4gICAgICAgIH1cblxuICAgICAgICBtYXJrZXIuY29udGVudCA9ICc8YnI+PGRpdiBjbGFzcz1cImxhYmVsc1wiPicgKyAnPGRpdiBjbGFzcz1cInRpdGxlXCI+JyArIG1hcmtlci50aXRsZSArXG4gICAgICAgICAgICAnPC9kaXY+PGRpdiBjbGFzcz1cInJhdGluZ1wiPkZvdXJzcXVhcmUgcmF0aW5nOiAnICsgbWFya2VyLnJhdGluZyArICc8L2Rpdj4nICsgJzwvZGl2Pic7XG5cbiAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xuXG4gICAgICAgIGFsZXJ0KFwiQ291bGQgbm90IGxvYWQgZGF0YSBmcm9tIGZvdXJzcXVhcmUhXCIpO1xuICAgIH0pO1xuXG4gICAgLy8gRU5EIEZPVVJTUVVBUkUgQUpBWFxufVxuXG5cbi8vIFNldCBhbmltYXRpb24gXG5mdW5jdGlvbiB0b2dnbGVCb3VuY2UobWFya2VyKSB7XG4gICAgaWYgKG1hcmtlci5nZXRBbmltYXRpb24oKSAhPT0gbnVsbCkge1xuICAgICAgICBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xuICAgICAgICB9LCA3NTApO1xuICAgIH1cbn1cbi8vIFRoaXMgZnVuY3Rpb24gcG9wdWxhdGVzIHRoZSBpbmZvd2luZG93IHdoZW4gdGhlIG1hcmtlciBpcyBjbGlja2VkLiBXZSdsbCBvbmx5IGFsbG93XG4vLyBvbmUgaW5mb3dpbmRvdyB3aGljaCB3aWxsIG9wZW4gYXQgdGhlIG1hcmtlciB0aGF0IGlzIGNsaWNrZWQsIGFuZCBwb3B1bGF0ZSBiYXNlZFxuLy8gb24gdGhhdCBtYXJrZXJzIHBvc2l0aW9uLlxuZnVuY3Rpb24gcG9wdWxhdGVJbmZvV2luZG93KG1hcmtlciwgaW5mb3dpbmRvdykge1xuICAgIC8vIENoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgaW5mb3dpbmRvdyBpcyBub3QgYWxyZWFkeSBvcGVuZWQgb24gdGhpcyBtYXJrZXIuXG4gICAgaWYgKGluZm93aW5kb3cubWFya2VyICE9IG1hcmtlcikge1xuICAgICAgICBpbmZvd2luZG93Lm1hcmtlciA9IG1hcmtlcjtcbiAgICAgICAgaW5mb3dpbmRvdy5zZXRDb250ZW50KCc8ZGl2PicgKyBtYXJrZXIuY29udGVudCArICc8L2Rpdj4nKTtcbiAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBtYXJrZXIgcHJvcGVydHkgaXMgY2xlYXJlZCBpZiB0aGUgaW5mb3dpbmRvdyBpcyBjbG9zZWQuXG4gICAgICAgIGluZm93aW5kb3cuYWRkTGlzdGVuZXIoJ2Nsb3NlY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGluZm93aW5kb3cubWFya2VyID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfVxufSIsIi8vVmlld01vZGVsXG5cbmZ1bmN0aW9uIFZpZXdNb2RlbCgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBzZWxmLmxpc3QgPSBrby5vYnNlcnZhYmxlQXJyYXkoZGF0YUFycmF5KTtcbiAgICBzZWxmLmN1cnJlbnRGaWx0ZXIgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgc2VsZi5maWx0ZXJzID0ga28ub2JzZXJ2YWJsZUFycmF5KFswLCAxXSk7XG4gICAgc2VsZi5maWx0ZXIgPSBrby5vYnNlcnZhYmxlKCcnKTtcblxuICAgIHNlbGYubG9jYXRpb25TZWxlY3QgPSBmdW5jdGlvbihsb2MpIHtcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcihsb2MsICdjbGljaycpO1xuICAgIH07XG5cbiAgICBzZWxmLmZpbHRlcmVkSXRlbXMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGZpbHRlciA9IHNlbGYuZmlsdGVyKCk7XG4gICAgICAgIGlmICghZmlsdGVyIHx8IGZpbHRlciA9PSAwKSB7XG5cbiAgICAgICAgICAgIC8vIFNIT1cgQUxMIE1BUktFUlMgV0hFTiBGSUxURVIgUkVTRVRTXG4gICAgICAgICAgICBtYXJrZXJzKCkuZm9yRWFjaChmdW5jdGlvbihtYXJrZXIpIHtcbiAgICAgICAgICAgICAgICBtYXJrZXIuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG1hcmtlcnMoKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGtvLnV0aWxzLmFycmF5RmlsdGVyKG1hcmtlcnMoKSwgZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgIC8vIENSRUFURSBNQVRDSCBWQVJJQUJMRSBUTyBVU0UgVE8gU0VUIE1BUktFUiBWSVNJQklMSVRZXG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gaS5nZW5yZSA9PSBmaWx0ZXI7XG4gICAgICAgICAgICAgICAgaS5zZXRWaXNpYmxlKG1hdGNoKTtcbiAgICAgICAgICAgICAgICAvL2Nsb3NlIGFueSBvcGVuIGluZm93aW5kb3dzXG4gICAgICAgICAgICAgICAgaWYgKGluZm93aW5kb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxufVxuXG4vLyBBY3RpdmF0ZXMga25vY2tvdXQuanNcbmtvLmFwcGx5QmluZGluZ3MobmV3IFZpZXdNb2RlbCgpKTsiLCJ2YXIgZGF0YUFycmF5ID0gW3tcbiAgICB0aXRsZTogJ1BhcmsgQXZlIFBlbnRob3VzZScsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43NzEzMDI0LFxuICAgICAgICBsbmc6IC03My45NjMyMzkzXG4gICAgfSxcbiAgICBnZW5yZTogJzEnXG59LCB7XG4gICAgdGl0bGU6ICdDaGVsc2VhIExvZnQnLFxuICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIGxhdDogNDAuNzQ0NDg4MyxcbiAgICAgICAgbG5nOiAtNzMuOTk0OTQ2NVxuICAgIH0sXG4gICAgZ2VucmU6ICcwJ1xufSwge1xuICAgIHRpdGxlOiAnVW5pb24gU3F1YXJlIE9wZW4gRmxvb3IgUGxhbicsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43MzQ3MDYyLFxuICAgICAgICBsbmc6IC03My45ODk1NzU5XG4gICAgfSxcbiAgICBnZW5yZTogJzEnXG59LCB7XG4gICAgdGl0bGU6ICdFYXN0IFZpbGxhZ2UgSGlwIFN0dWRpbycsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43MjgxNzc3LFxuICAgICAgICBsbmc6IC03My45ODQzNzdcbiAgICB9LFxuICAgIGdlbnJlOiAnMCdcbn0sIHtcbiAgICB0aXRsZTogJ1RyaUJlQ2EgQXJ0c3kgQmFjaGVsb3IgUGFkJyxcbiAgICBsb2NhdGlvbjoge1xuICAgICAgICBsYXQ6IDQwLjcxOTUyNjQsXG4gICAgICAgIGxuZzogLTc0LjAwODk5MzRcbiAgICB9LFxuICAgIGdlbnJlOiAnMSdcbn0sIHtcbiAgICB0aXRsZTogJ0NoaW5hdG93biBIb21leSBTcGFjZScsXG4gICAgbG9jYXRpb246IHtcbiAgICAgICAgbGF0OiA0MC43MTgwNjI4LFxuICAgICAgICBsbmc6IC03My45OTYxMjM3XG4gICAgfSxcbiAgICBnZW5yZTogJzAnXG59XTsiXX0=
